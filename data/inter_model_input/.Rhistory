median_age=median(age),
min_age=min(age),
max_age=max(age),
iqr_age=IQR(age),
q25 = quantile(age, 0.25),
q75=quantile(age, 0.75)
)
dim(COVID19_LoS)
sex_distri <- table(COVID19_LoS$gender)
proportions(sex_distri)
# wave <- COVID19_LoS %>%
#   group_by(wave) %>% 9
#   summarise(N=n())
proportions(wave)
linear_dat <- COVID19_LoS %>%
mutate(across(.cols = c(gender, wave, hosp_id),
.fns = as.factor)) %>%
filter(mort_hospital==0) %>%
drop_na()
# assumptions
library(preference)
library(easystats)
library(easystats)
library(see)
library(see)
#model
linear1 <- lm(log(LoS) ~ Ct, data =linear_dat)
summary(linear1)
summary(linear1)
plot(linear1)
summary(linear1)
plot(linear1)
linear2 <- lm(log(LoS)~Ct+age+gender+wave, data = linear_dat)
summary(linear2)
plot(linear2)
linear3 <- lm(log(LoS)~Ct+gender+age*wave, data = linear_dat)
summary(linear3)
plot(linear3)
plot(linear3)
linear4 <- lm(log(LoS)~Ct+wave+gender*age, data = linear_dat)
summary(linear4)
plot(linear4)
# choose model
AIC(linear1, linear2, linear3, linear4)
# asumptions
# package see and ggplot2 required for check_model
shapiro.test(COVID19_LoS$LoS)
hist(COVID19_LoS$LoS)
hist(log(COVID19_LoS$LoS))
#check
check_model(linear3)
library(car)
cr.plot(linear3)
crPlot(linear3)
crPlot(linear3, variable = age)
crPlot(linear3, variable = linear_dat$age)
crPlot(linear3, variable = linear3$model)
crPlot(linear3, variable = model)
crPlot(linear3)
car::vif(linear3)
hist(COVID19_LoS$LoS)
hist(log(linear_dat$LoS))
hist(linear_dat$LoS)
hist(log(linear_dat$LoS))
pdf(file = "MyAwsomeFigure4.pdf", useDingbats = FALSE)
par(mfrow = c(2,1), mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
hist(linear_dat$LoS)
hist(log(linear_dat$LoS))
while (!is.null(dev.list()))  dev.off()
#check
plot(linear3)
par(mfrow = c(2,2))
plot(linear3)
pdf(file = "MyAwsomeFigure5.pdf", useDingbats = FALSE)
par(mfrow = c(2,2), mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
plot(linear3)
pdf(file = "MyAwsomeFigure5.pdf", useDingbats = FALSE)
par(mfrow = c(2,2), lwd = 96/72, pch = 16, ps = 8 )
plot(linear3)
while (!is.null(dev.list()))  dev.off()
#check
pdf(file = "MyAwsomeFigure5.pdf", useDingbats = FALSE)
par(mfrow = c(2,2), mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
plot(linear3)
while (!is.null(dev.list()))  dev.off()
pdf(file = "MyAwsomeFigure5.pdf", useDingbats = FALSE)
par(mfrow = c(2,2), mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
plot(linear3)
pdf(file = "MyAwsomeFigure5.pdf", useDingbats = FALSE)
par(mfrow = c(2,2), mai = c(1,1,1,1), lwd = 96/72, pch = 16, ps = 8 )
plot(linear3)
while (!is.null(dev.list()))  dev.off()
plot(linear3)
pdf(file = "MyAwsomeFigure5.pdf", useDingbats = FALSE)
par(mfrow = c(2,2))
plot(linear3)
while (!is.null(dev.list()))  dev.off()
par(mfrow = c(2,2))
plot(linear3)
pdf(file = "MyAwsomeFigure4.pdf", useDingbats = FALSE)
par(mfrow = c(2,2))
plot(linear3)
while (!is.null(dev.list()))  dev.off()
#plots
library(sjPlot)
library(effects)
library(carData)
library(lattice)
plot_model(linear3,
axis.labels=c("gender-male", "Ct value", "age", "wave -2", "wave-3",
"age x wave-2", "age x wave-3"),
show.values=TRUE, show.p=TRUE,
title="Effect of age, gender, Ct value and wave on hopsital Length of Stay")
# interaction
plot(allEffects(linear3), lines = list(multiline = TRUE))
while (!is.null(dev.list()))  dev.off()
pdf(file = "MyAwsomeFigure6.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
plot_model(linear3,
axis.labels=c("gender-male", "Ct value", "age", "wave -2", "wave-3",
"age x wave-2", "age x wave-3"),
show.values=TRUE, show.p=TRUE,
title="Effect of age, gender, Ct value and wave on hopsital Length of Stay")
while (!is.null(dev.list()))  dev.off()
pdf(file = "MyAwsomeFigure7.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
plot(allEffects(linear3), lines = list(multiline = TRUE))
while (!is.null(dev.list()))  dev.off()
par(mfrow = c(2,2))
plot(linear3)
sex_tab <- table(excluded_data$gender, excluded_data$mort_hospital)
proportions(sex_tab)
prop.test(sex_tab)
chisq.test(sex_tab)
prop.test(sex_tab)
waves <- table(COVID19_LoS$wave, COVID19_LoS$mort_hospital)
new_data <- COVID19_LoS %>%
filter(mort_hospital == 1)
# setup
setwd("/Users/vincentarumadri/Desktop/Epi/Semester 2/Modern methods of Data Analysis/Classical-and-Modern-Data-Analysis-")
library(rio)
library(tidyverse)
library(skimr)
library(epiR)
# import data set
COVID19_LoS <- import("covid_data.txt")
dim(COVID19_LoS)
skim(COVID19_LoS)
head(COVID19_LoS)
COVID19_LoS %>%
select(age) %>%
summarise(
median_age=median(age),
min_age=min(age),
max_age=max(age),
iqr_age=IQR(age),
q25 = quantile(age, 0.25),
q75=quantile(age, 0.75)
)
dim(COVID19_LoS)
sex_distri <- table(COVID19_LoS$gender)
proportions(sex_distri)
# wave <- COVID19_LoS %>%
#   group_by(wave) %>% 9
#   summarise(N=n())
proportions(wave)
new_data <- COVID19_LoS %>%
filter(mort_hospital == 1)
sex_tab <- table(COVID19_LoS$gender, COVID19_LoS$mort_hospital)
proportions(sex_tab)
prop.test(sex_tab)
sex_tab
prop.test(sex_tab)
sex_tab <- table(COVID19_LoS$mort_hospital, COVID19_LoS$gender)
sex_tab
prop.test(x = c(656, 1026), n = )
prop.test(sex_tab)
sex_tab <- table(COVID19_LoS$gender, COVID19_LoS$mort_hospital)
sex_tab
prop.test(x = c(656, 1026), n = c(4094, 4208))
# setup
setwd("/Users/vincentarumadri/Desktop/Epi/Semester 2/Modern methods of Data Analysis/Classical-and-Modern-Data-Analysis-")
library(rio)
library(tidyverse)
library(skimr)
library(epiR)
# import data set
COVID19_LoS <- import("covid_data.txt")
dim(COVID19_LoS)
skim(COVID19_LoS)
head(COVID19_LoS)
COVID19_LoS %>%
select(age) %>%
summarise(
median_age=median(age),
min_age=min(age),
max_age=max(age),
iqr_age=IQR(age),
q25 = quantile(age, 0.25),
q75=quantile(age, 0.75)
)
dim(COVID19_LoS)
sex_distri <- table(COVID19_LoS$gender)
proportions(sex_distri)
wave <- COVID19_LoS %>%
group_by(wave) %>% 9
# setup
setwd("/Users/vincentarumadri/Desktop/Epi/Semester 2/Modern methods of Data Analysis/Classical-and-Modern-Data-Analysis-")
library(rio)
library(tidyverse)
library(skimr)
library(epiR)
# import data set
COVID19_LoS <- import("covid_data.txt")
dim(COVID19_LoS)
skim(COVID19_LoS)
head(COVID19_LoS)
COVID19_LoS %>%
select(age) %>%
summarise(
median_age=median(age),
min_age=min(age),
max_age=max(age),
iqr_age=IQR(age),
q25 = quantile(age, 0.25),
q75=quantile(age, 0.75)
)
dim(COVID19_LoS)
sex_distri <- table(COVID19_LoS$gender)
proportions(sex_distri)
wave <- COVID19_LoS %>%
group_by(wave) %>%
summarise(N=n())
proportions(wave)
#image 2
pdf(file = "MyAwsomeFigure.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
ggplot(COVID19_LoS, aes(x = as.factor(gender), y = LoS, fill = as.factor(gender))) +
geom_boxplot() +
xlab("gender") +
ylab("LoS") +
ggtitle("Boxplot of LoS and Gender")+
scale_fill_manual(values = c("0" = "red", "1"= "green"),
labels = c("0" = "female", "1" = "male"))
while (!is.null(dev.list()))  dev.off()
# image 2
pdf(file = "MyAwsomeFigure1.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
ggplot(COVID19_LoS, aes(x = as.factor(wave), y = LoS, fill = as.factor(wave))) +
geom_boxplot() +
xlab("wave") +
ylab("LoS") +
ggtitle("Boxplot of LoS and Wave")
while (!is.null(dev.list()))  dev.off()
# image 3
pdf(file = "MyAwsomeFigure3.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
ggplot(COVID19_LoS, aes(x = as.factor(mort_hospital), y = LoS, fill = as.factor(mort_hospital))) +
geom_boxplot() +
xlab("mortality") +
ylab("LoS") +
ggtitle("Boxplot of LoS and Mortality") +
scale_fill_manual(values = c("0" = "red", "1"= "green"),
labels = c("0" = "recovered", "1" = "died"))
while (!is.null(dev.list()))  dev.off()
waves <- table(COVID19_LoS$wave, COVID19_LoS$mort_hospital)
# addmargins(waves)
waves
proportions(waves, margin = 1)
############################################################################################
library(janitor)
library(flextable)
tables_new <- excluded_data %>%                                  # case linelist
tabyl(wave, gender, mort_hospital) %>%                  # cross-tabulate counts
adorn_totals(where = "row") %>%             # add a total row
adorn_percentages(denominator = "col") %>%  # convert to proportions
adorn_pct_formatting() %>%                  # convert to percents
adorn_ns(position = "front") %>%            # display as: "count (percent)"
adorn_title(                                # adjust titles
row_name = "waves",
col_name = "Gender")
# rename
names(tables_new)[1] <- "Recovered"
names(tables_new)[2] <- "Died"
tables_new
library(kableExtra)
recovered <- print(tables_new$Recovered)
died <- print(tables_new$Died)
formatted_table1 <- kable(recovered, align = "c", caption = "Recovered Cases") %>%
kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
formatted_table2 <- kable(died, align = "c", caption = "Dead Cases") %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), latex_options = "striped", full_width = FALSE, font_size = 15)
formatted_table2
formatted_table1
print(tables_new$Died)
sex_tab <- table(COVID19_LoS$gender, COVID19_LoS$mort_hospital)
sex_tab
prop.test(x = c(656, 1026), n = c(4094, 4208))
prop.test(x = c(656, 1026), n = c(4750, 5234))
chisq.test(waves)
proportions(waves)
# addmargins(waves)
waves
COVID19_LoS <- COVID19_LoS %>%
drop_na()
dim(COVID19_LoS)
skim(COVID19_LoS)
head(COVID19_LoS)
COVID19_LoS %>%
select(age) %>%
summarise(
median_age=median(age),
min_age=min(age),
max_age=max(age),
iqr_age=IQR(age),
q25 = quantile(age, 0.25),
q75=quantile(age, 0.75)
)
dim(COVID19_LoS)
sex_distri <- table(COVID19_LoS$gender)
proportions(sex_distri)
wave <- COVID19_LoS %>%
group_by(wave) %>%
summarise(N=n())
proportions(wave)
#image 2
pdf(file = "MyAwsomeFigure.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
ggplot(COVID19_LoS, aes(x = as.factor(gender), y = LoS, fill = as.factor(gender))) +
geom_boxplot() +
xlab("gender") +
ylab("LoS") +
ggtitle("Boxplot of LoS and Gender")+
scale_fill_manual(values = c("0" = "red", "1"= "green"),
labels = c("0" = "female", "1" = "male"))
while (!is.null(dev.list()))  dev.off()
# image 2
pdf(file = "MyAwsomeFigure1.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
ggplot(COVID19_LoS, aes(x = as.factor(wave), y = LoS, fill = as.factor(wave))) +
geom_boxplot() +
xlab("wave") +
ylab("LoS") +
ggtitle("Boxplot of LoS and Wave")
while (!is.null(dev.list()))  dev.off()
# image 3
pdf(file = "MyAwsomeFigure3.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
ggplot(COVID19_LoS, aes(x = as.factor(mort_hospital), y = LoS, fill = as.factor(mort_hospital))) +
geom_boxplot() +
xlab("mortality") +
ylab("LoS") +
ggtitle("Boxplot of LoS and Mortality") +
scale_fill_manual(values = c("0" = "red", "1"= "green"),
labels = c("0" = "recovered", "1" = "died"))
while (!is.null(dev.list()))  dev.off()
waves <- table(COVID19_LoS$wave, COVID19_LoS$mort_hospital)
# addmargins(waves)
waves
proportions(waves)
chisq.test(waves)
sex_tab <- table(COVID19_LoS$gender, COVID19_LoS$mort_hospital)
sex_tab
prop.test(x = c(656, 1026), n = c(4750, 5234))
prop.test(x = c(622, 983), n = c(4560, 5,028))
prop.test(x = c(622, 983), n = c(4560, 5028))
linear_dat <- COVID19_LoS %>%
mutate(across(.cols = c(gender, wave, hosp_id),
.fns = as.factor)) %>%
filter(mort_hospital==0)
library(preference)
library(easystats)
library(see)
linear3 <- lm(log(LoS)~Ct+gender+age*wave, data = linear_dat)
summary(linear3)
dim(linear_dat)
confint(linear3)
# pairwaise comparison
TukeyHSD(fit1)
new_data <- COVID19_LoS %>%
mutate(across(.cols = c(gender, wave, hosp_id),
.fns = as.factor)) %>%
filter(mort_hospital==0) %>%
drop_na()
# anova
fit1 <- aov(LoS~gender+wave, data = new_data)
cooks.distance(fit1)/length(new_data$gender)
# pairwaise comparison
TukeyHSD(fit1)
confint(linear3)
summary(linear3)
# pairwaise comparison
TukeyHSD(fit1)
# anova
fit1 <- aov(log(LoS)~gender+wave, data = new_data)
summary(fit1)
summary(fit1)
ggplot(linear_dat, aes(x=log(LoS), y=age))+
geom_point()
ggplot(linear_dat, aes(x=age, y=log(LoS)))+
geom_point()
linear_dat <- COVID19_LoS %>%
mutate(across(.cols = c(gender, wave, hosp_id),
.fns = as.factor)) %>%
filter(mort_hospital==0)
# assumptions
library(preference)
library(easystats)
library(see)
#model
linear1 <- lm(log(LoS) ~ Ct, data =linear_dat)
summary(linear1)
plot(linear1)
linear2 <- lm(log(LoS)~Ct+age+gender+wave, data = linear_dat)
summary(linear2)
plot(linear2)
linear3 <- lm(log(LoS)~Ct+gender+age*wave, data = linear_dat)
summary(linear3)
plot(linear3)
confint(linear3)
linear4 <- lm(log(LoS)~Ct+wave+gender*age, data = linear_dat)
summary(linear4)
plot(linear4)
# choose model
AIC(linear1, linear2, linear3, linear4)
# asumptions
# package see and ggplot2 required for check_model
pdf(file = "MyAwsomeFigure4.pdf", useDingbats = FALSE)
par(mfrow = c(2,1), mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
hist(linear_dat$LoS)
hist(log(linear_dat$LoS))
while (!is.null(dev.list()))  dev.off()
#check
pdf(file = "MyAwsomeFigure4.pdf", useDingbats = FALSE)
par(mfrow = c(2,2))
plot(linear3)
while (!is.null(dev.list()))  dev.off()
#plots
library(sjPlot)
library(effects)
library(carData)
library(lattice)
pdf(file = "MyAwsomeFigure6.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
plot_model(linear3,
axis.labels=c("gender-male", "Ct value", "age", "wave -2", "wave-3",
"age x wave-2", "age x wave-3"),
show.values=TRUE, show.p=TRUE,
title="Effect of age, gender, Ct value and wave on hopsital Length of Stay")
while (!is.null(dev.list()))  dev.off()
# interaction
pdf(file = "MyAwsomeFigure7.pdf", useDingbats = FALSE)
par( mai = c(1,2,1,2), lwd = 96/72, pch = 16, ps = 8 )
plot(allEffects(linear3), lines = list(multiline = TRUE))
while (!is.null(dev.list()))  dev.off()
tab_model(linear3)
library(lme4)
# random effects
#null
mixed_linear_null <- lmer(log(LoS)~(1|hosp_id), data =linear_dat)
summary(mixed_linear_null)
# icc for null
0.01996/(0.01996+0.17970)
# mixed effects model
mixed_linear <- lmer(log(LoS) ~ gender+Ct+age*wave +(1|hosp_id), data =linear_dat)
summary(mixed_linear)
# p value
summary_table <- summary(mixed_linear)$coefficients
p_values <- summary_table[, "t value"]
p_value <- 2 * (1 - pt(abs(p_values), 7975))
p_value
#ICC = 0.145
0.02065/(0.02065+0.12187)
# CI for variables
confint(mixed_linear)
# whether the random effects is required
mixed_linear_nohosp <- lm(log(LoS)~gender+Ct+age*wave, data = linear_dat)
# AIC for models
AIC(mixed_linear1, mixed_linear_nohosp)
# AIC for models
AIC(mixed_linear, mixed_linear_nohosp)
#  Likelihood ratio test for random center effect (using ML)
anova_output <- anova(mixed_linear, mixed_linear_nohosp)
anova_output
# p value
pval <- 0.5*anova_output$`Pr(>Chisq)`[2]
pval
#Likelihood ratio test for random center effect using REML
chi2 = -2*logLik(mixed_linear_nohosp, REML = T) + 2*logLik(mixed_linear, REML = T)
pval2 <- 0.5*pchisq(chi2, df=1, lower.tail=F)
pval2
# CI for variables
confint(mixed_linear)
# import functions and necessary dependencies
source("RSV CEA functions.R")
# original ICERs
get_ICER(uptake = 0.2)
# vaccine uptake to 0.1
get_ICER(uptake = 0.1)
# vaccine uptake to 0.7
get_ICER(uptake = 0.7)
# different rates for uptake
uptake_vector <- c(0.1, 0.2, 0.4, 0.6, 0.8, 1)
# run function
uptake_icer <- get_ICER_uptake(uptake_vector = uptake_vector)
plot_ICER_variation(x_values = uptake_vector, db = uptake_icer, x_lab = "uptake")
rm(list= ls())
rm(list = ls())
load("rsv_data_uk.RData")
setwd("/Users/vincentarumadri/Desktop/Epi/Modelling Internship & thesis/rsv_model_R_custom/data/inter_model_input")
load("rsv_data_uk.RData")
load("rsv_data_uk.RData")
